@page
@model Formify.Pages.CheckoutModel
@{
    ViewData["Title"] = "Оформление заказа";
}

<div style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;z-index:10000;font-family:Arial,sans-serif;">
    <div style="background:white;padding:30px;border-radius:10px;width:90%;max-width:500px;max-height:90vh;overflow-y:auto;box-shadow:0 10px 30px rgba(0,0,0,0.3);">
        <h2 style="margin-top:0;">🛒 Оформление заказа</h2>

        <div style="background:#e3f2fd;padding:15px;border-radius:8px;margin:20px 0;">
            <strong>Итого к оплате: <span style="color:#1976d2;font-size:20px;">@Model.TotalDisplay ₽</span></strong>
        </div>

        @if (!string.IsNullOrEmpty(Model.DebugInfo))
        {
            <div style="background:#fff3cd;color:#856404;padding:12px;border-radius:5px;margin:15px 0;font-family:monospace;font-size:13px;border-left:4px solid #ffc107;">
                🔍 @Model.DebugInfo
            </div>
        }

        @if (!string.IsNullOrEmpty(Model.ErrorMessage))
        {
            <div style="background:#f8d7da;color:#721c24;padding:12px;border-radius:5px;margin:15px 0;border:1px solid #f5c6cb;">
                ❌ @Model.ErrorMessage
            </div>
        }
        else if (!string.IsNullOrEmpty(Model.SuccessMessage))
        {
            <div style="background:#d4edda;color:#155724;padding:20px;border-radius:8px;margin:15px 0;border:1px solid #c3e6cb;text-align:center;">
                <div style="font-size:28px;margin-bottom:15px;">✅</div>
                <strong>@Model.SuccessMessage</strong>
                <br><br>
                <button type="button" onclick="closeWindow()" style="padding:12px 24px;background:#28a745;color:white;border:none;border-radius:6px;font-size:16px;cursor:pointer;">Закрыть окно</button>
            </div>
        }
        else
        {
            <form method="post">
                <div style="margin-bottom:15px;">
                    <label style="display:block;margin-bottom:5px;font-weight:bold;">ФИО *</label>
                    <input name="FullName" value="@Model.FullName" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:5px;box-sizing:border-box;font-size:16px;" placeholder="Иванов Иван Иванович" required />
                </div>

                <div style="margin-bottom:15px;">
                    <label style="display:block;margin-bottom:5px;font-weight:bold;">Телефон *</label>
                    <input name="Phone" value="@Model.Phone" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:5px;box-sizing:border-box;font-size:16px;" placeholder="+7 (999) 123-45-67" required />
                </div>

                <div style="margin-bottom:20px;">
                    <label style="display:block;margin-bottom:5px;font-weight:bold;">Адрес доставки *</label>
                    <textarea name="Address" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:5px;box-sizing:border-box;font-size:16px;resize:vertical;" rows="3" placeholder="г. Москва, ул. Ленина, д. 5, кв. 23" required>@Model.Address</textarea>
                </div>

                <button type="submit" style="width:100%;padding:18px;background:linear-gradient(45deg,#28a745,#20c997);color:white;border:none;border-radius:8px;font-size:18px;font-weight:bold;cursor:pointer;box-shadow:0 4px 15px rgba(40,167,69,0.3);">
                    💳 Оплатить заказ (@Model.TotalDisplay ₽)
                </button>
            </form>
        }

        <div style="text-align:center;margin-top:15px;">
            <button type="button" onclick="closeWindow()" style="padding:12px 24px;background:#6c757d;color:white;border:none;border-radius:5px;font-size:16px;cursor:pointer;width:100%;">❌ Отмена</button>
        </div>
    </div>
</div>

<script>
    function closeWindow() { window.close(); }
    window.addEventListener('keydown', function(e) { if (e.key === 'Escape') closeWindow(); });
</script>
